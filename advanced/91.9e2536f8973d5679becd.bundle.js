(self.webpackChunkadvanced=self.webpackChunkadvanced||[]).push([[91],{91:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>A});var a=n(5032),s=n(4427),r=n.n(s),i=n(2511),o=n(5716),l=n(8219),c=n(2356);const d={currentIndex:0},u=(0,a.createContext)(d),m=(e,t)=>{switch(t.type){case"UPDATE_CURRENT_INDEX":return{...e,currentIndex:(0,c.W)(t.payload.index,t.payload.slideLength-1,e.currentIndex)};default:return e}},h=e=>({type:"UPDATE_CURRENT_INDEX",payload:e}),p=({children:e})=>{const[t,n]=(0,a.useReducer)(m,d);return a.createElement(u.Provider,{value:{state:t,dispatch:n}},e)};class E{constructor(){this.receiverQuery="?presenter=view",this.apiType="function"==typeof window.PresentationRequest?"presentation":"localStorage",this.windowId=null}openView(){return new Promise(((e,t)=>{"presentation"===this.apiType?(this.presentationRequest=new PresentationRequest([this.receiverQuery]),navigator.presentation.defaultRequest=this.presentationRequest,this.presentationRequest.addEventListener("connectionavailable",(t=>{this.presentationConnection=t.connection,e(t.connection.id)})),this.presentationRequest.start().catch((e=>t(e)))):(this.windowId=window.open(this.receiverQuery,"_blank","width=800,height=600"),e())}))}changePage(e){const t=JSON.stringify({date:Date.now(),page:e});"presentation"===this.apiType&&this.presentationConnection&&this.presentationConnection.send(t),"localStorage"===this.apiType&&window.localStorage.setItem("page",t)}async reconnect(e){return"presentation"===this.apiType?this.presentationRequest.reconnect(e):Promise.resolve()}terminate(){"presentation"===this.apiType&&this.presentationConnection?(this.presentationConnection.terminate(),this.presentationConnection.close(),this.presentationConnection=null):this.windowId&&(this.windowId.close(),this.windowId=null)}}var v=n(9547);let f=["#444","#3498db","#ff874d","#67a2a0"],g=null,w=null;const R=(0,a.memo)((({toolbar:e,disabled:t,hideGrid:n})=>{const s=(0,a.useRef)(),[r,l]=(0,a.useState)(f[0]),c=()=>{window.localStorage.setItem("fusumaCanvasCoordinate",s.current.getSaveData())},d=()=>{const e=window.localStorage.getItem("fusumaCanvasCoordinate");g!==e&&(s.current.loadSaveData(e,!0),g=e)};return(0,a.useEffect)((()=>(w=e?setInterval(c,1e3):setInterval(d,1e3),()=>{w&&clearInterval(w)})),[]),a.createElement(a.Fragment,null,e&&a.createElement("div",{className:"fusuma-canvas-toolbar"},a.createElement(o.ZkW,{onClick:()=>{s.current.clear()},size:"32"}),a.createElement(i.wXW,{onClick:()=>{s.current.undo()}}),a.createElement("div",{style:{background:r},onClick:()=>{f=f.concat(f.splice(0,1)),l(f[0])},className:"fusuma-canvas-toolbar-color"})),a.createElement(v.Z,{ref:s,className:"fusuma-canvas",canvasWidth:"100%",canvasHeight:"100%",loadTimeOffset:0,brushColor:r,disabled:t,hideGrid:n,lazyRadius:0,brushRadius:8}))}));function b(e){window.localStorage.setItem("fusumaCanvasEvent",JSON.stringify(e))}function y(e){const t=Math.floor(e/1e3%60).toString().padStart(2,"0"),n=Math.floor(e/6e4%60).toString().padStart(2,"0");return`${Math.floor(e/36e5%24).toString().padStart(2,"0")}:${n}:${t}`}let S=0,C=null;const N=(0,a.memo)((({start:e,stop:t,reset:n,disabledStart:s,disabledStop:r,disabledReset:o})=>{const[l,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)("00:00:00");return(0,a.useEffect)((()=>()=>{C&&clearInterval(C)}),[]),a.createElement("div",{className:"host-timer"},a.createElement(i.xrw,{onClick:()=>{C&&t(),S=0,u("00:00:00"),n()},className:o?"disabled":void 0}),l?a.createElement(i.gmG,{onClick:()=>{C=setInterval((()=>(S+=1e3,void u(y(S)))),1e3),c(!1),e()},className:s?"disabled":void 0}):a.createElement(i.JuG,{onClick:()=>{clearInterval(C),c(!0),C=null,t()},className:r?"disabled":void 0}),a.createElement("span",null,d))}));var I=n(3749);const k=({items:e,url:t})=>{const n=(0,a.useRef)();return(0,a.useEffect)((()=>{if(n.current){const t=n.current,a=async()=>new Promise((e=>{t.addEventListener("loadedmetadata",(()=>{if(t.duration===1/0){t.currentTime=Number.MAX_SAFE_INTEGER;const n=()=>{t.currentTime=0,t.removeEventListener("timeupdate",n),e()};t.addEventListener("timeupdate",n)}}))})),s=document.querySelectorAll(".ReactModalPortal section > div");a();{let e=!1;t.addEventListener("playing",(()=>{e||(t.currentTime=0,e=!0)}))}t.addEventListener("timeupdate",(()=>{const n=(t=>{let n=0;for(let a=0;a<e.length;a++){const{time:s}=e[a];if(t<=s){n=a;break}}return n})(1e3*t.currentTime);s[n].scrollIntoView()}))}}),[]),a.createElement("div",{className:"host-timeline-container"},t&&a.createElement("div",{className:"host-timeline-audio"},a.createElement("audio",{src:t,controls:!0,ref:n})),a.createElement("div",{className:"host-timeline-body"},a.createElement(I.TY,null,e.map((({title:e,time:t,timeStr:n,Slide:s,color:r,Icon:i})=>a.createElement(I.BJ,{key:t,title:e,createdAt:n,iconColor:r,icon:i},s&&a.createElement(s,null)))))))};var T=n(9134);r().setAppElement("#root");const x=({slideUrl:e,slideIndex:t})=>a.createElement("iframe",{src:`${e.replace(/slide-(\d?)/,`slide-${t}`)}`,width:"100%",height:"100%"});let L=null,P=null,D=null,U=[],$=0,q=null;const M=()=>{const{state:{slides:e},dispatch:t}=(0,l.re)(),{state:{currentIndex:n},dispatch:s}=(0,a.useContext)(u);if(!D){const{origin:e,pathname:t}=new URL(window.location);P=`${e}${t}?sidebar=false&reference=false#slide-`,D=new E}const[c,d]=(0,a.useState)("prepare"),[m,p]=(0,a.useState)(!1),[v,f]=(0,a.useState)(!1),[g,w]=(0,a.useState)(!0),[S,C]=(0,a.useState)(!1),I=()=>{try{D&&(D.terminate(),D=null)}catch(e){console.error(e)}finally{t((0,l.PM)("common"))}},M=()=>{0===U.length&&($=(new Date).getTime());const t=0===U.length?0:(new Date).getTime()-$;U.push({slideNum:n+1,time:t,timeStr:y(t),event:"started",title:`Started from the ${n+1} slide.`,Slide:e[n].slide,color:"#6fba1c",Icon:a.createElement(i.qL$,null)}),m&&(L.startRecording(),q=null),w(!1),d("start")},A=()=>{L&&(L.disposeRecording(),L=null),p(!1)};return(0,a.useEffect)((()=>{(async()=>{try{if(!D)throw new Error("Not found PresenterController.");await D.openView()}catch(e){console.error(e)}})();const t=({key:t})=>{const n=e.length;"ArrowLeft"===t?s(h({index:"-",slideLength:n})):"ArrowRight"===t&&s(h({index:"+",slideLength:n}))};return document.addEventListener("keydown",t,!1),()=>{D&&I(),A(),document.removeEventListener("keydown",t)}}),[]),a.createElement("div",{className:"host-container"},a.createElement(r(),{isOpen:v,onRequestClose:()=>f(!1)},a.createElement(k,{items:U,url:q})),a.createElement("div",{className:"host-left-box"},a.createElement("div",{className:"host-note"},e&&a.createElement("pre",{dangerouslySetInnerHTML:{__html:e[n].fusumaProps.note}}))),a.createElement("div",{className:"host-right-box"},a.createElement("div",{className:"host-slide-layer"},a.createElement("h2",null,"Current"),a.createElement(o.e$R,{size:28,onClick:()=>{C(!0),b({status:"start"})}}),a.createElement(x,{slideUrl:P,slideIndex:n+1})),a.createElement(r(),{isOpen:S,onRequestClose:()=>{C(!1),b({status:"stop"})}},S&&a.createElement("div",{className:"host-slide-canvas"},a.createElement(R,{toolbar:!0,hideGrid:!0}),a.createElement(x,{slideUrl:P,slideIndex:n+1}))),a.createElement("div",{className:"host-slide-layer"},a.createElement("h2",null,"Next"),a.createElement(x,{slideUrl:P,slideIndex:n+2}))),a.createElement("div",{className:"host-bottom-box"},a.createElement(i.aHS,{onClick:I,className:"terminate-button"}),a.createElement("div",{className:"host-bottom-box-info"},a.createElement(N,{start:M,stop:async()=>{const e=(new Date).getTime()-$;U.push({slideNum:n+1,time:e,timeStr:y(e),event:"stopped",title:`Stopped at the ${n+1} slide.`,color:"#e9546b",Icon:a.createElement(i.IkZ,null)}),m&&(q=await L.stopRecording()),d("stop")},reset:()=>{q=null,U=[],$=0,d("prepare"),w(!0)},disabledStart:"stop"===c&&m&&!M.isEmptyRecordedTimeline,disabledStop:"stop"===c&&m&&!M.isEmptyRecordedTimeline,disabledReset:"start"===c&&m}),a.createElement("span",{className:"current-slide-num"},`${n+1}`.padStart(2,"0")," / ",`${e.length}`.padStart(2,"0")),a.createElement(i.ceS,{onClick:()=>f(!0),size:18,className:"start"===c&&m||g?"disabled":void 0}),m?a.createElement(i.kOf,{onClick:A,className:"start"!==c&&g?void 0:"disabled",size:20,color:"#6fba1c"}):a.createElement(i.WzD,{onClick:()=>{if(!L)try{L=new T.u,L.setupRecording(),p(!0)}catch(e){alert(e)}},className:"start"!==c&&g?void 0:"disabled",size:20}))))},A=(0,a.memo)((()=>a.createElement(p,null,a.createElement(M,null))))},9134:(e,t,n)=>{"use strict";n.d(t,{u:()=>a});class a{constructor(){if(!navigator.mediaDevices.getUserMedia)throw new Error("Not supported");this.url=null,this.finishedProcess=!1}setupRecording(){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(this.handlerRecording)}handlerRecording(e){const t=[];this.stream=e,this.mediaRecorder=new MediaRecorder(e,{}),this.mediaRecorder.addEventListener("dataavailable",(e=>{e.data.size>0&&t.push(e.data)})),this.mediaRecorder.addEventListener("stop",(()=>{this.finishedProcess=!0,this.url=URL.createObjectURL(new Blob(t,{type:"audio/webm"}))}))}startRecording(){this.mediaRecorder.start(),this.finishedProcess=!1,this.url=null}stopRecording(){return new Promise((e=>{this.mediaRecorder.stop();const t=setInterval((()=>{this.finishedProcess&&(clearInterval(t),e(this.url))}),100)}))}disposeRecording(){this.mediaRecorder.stream.getTracks().forEach((e=>e.stop())),this.finishedProcess=!1,this.url=null}async startCapturing(e){let t=null;try{t=await navigator.mediaDevices.getDisplayMedia(e)}catch(e){console.error(e)}return t}stopCapturing(e){e.srcObject.getTracks().forEach((e=>e.stop())),e.srcObject=null}}}}]);